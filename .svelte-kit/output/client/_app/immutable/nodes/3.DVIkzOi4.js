import{s as T,h as L,j as W,c as Y,o as Z,k as x,n as U}from"../chunks/BYyOunbz.js";import{S as H,i as J,z as j,d as h,q as y,k as A,l as M,w as d,u as S,a as V,b as K,m as Q,v as R,c as v,e as F,o as N,r as O,h as w,A as ee}from"../chunks/DccytuDx.js";import{P as ne,a as te,W as ae,I as se}from"../chunks/DZllC87U.js";import{w as ie}from"../chunks/Ss6Sc9Nf.js";let k=null,B=null,$={x:0,y:0,z:0};const P=4;async function oe(t,e){const o=await re(),a=()=>{var m,l,r;const s=o.detectForVideo(t,Date.now());s!=null&&s.faceLandmarks&&($.x=(m=s==null?void 0:s.faceLandmarks[0])==null?void 0:m[P].x,$.y=(l=s==null?void 0:s.faceLandmarks[0])==null?void 0:l[P].y,$.z=(r=s==null?void 0:s.faceLandmarks[0])==null?void 0:r[P].x),e($,k),k=requestAnimationFrame(a)};t.addEventListener("loadeddata",a)}async function le(){k&&(cancelAnimationFrame(k),k=null)}async function re(){const t=await ne.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm");return B=await te.createFromOptions(t,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task",delegate:"GPU"},outputFaceBlendshapes:!0,runningMode:"VIDEO",numFaces:1}),B}function G(t){let e,o,a="Enable webcam",s,m;return{c(){e=w("div"),o=w("div"),o.textContent=a,this.h()},l(l){e=v(l,"DIV",{id:!0,class:!0});var r=F(e);o=v(r,"DIV",{class:!0,"data-svelte-h":!0}),ee(o)!=="svelte-tcg226"&&(o.textContent=a),r.forEach(h),this.h()},h(){d(o,"class","button svelte-1q3b5km"),d(e,"id","enable-webcam"),d(e,"class","svelte-1q3b5km")},m(l,r){V(l,e,r),K(e,o),t[11](o),s||(m=Q(e,"click",t[12]),s=!0)},p:U,d(l){l&&h(e),t[11](null),s=!1,m()}}}function ce(t){let e,o,a,s,m,l,r,f,_,u,p,b,E;function z(n){t[8](n)}let q={active:t[1]};t[0]!==void 0&&(q.webCamElem=t[0]),e=new ae({props:q}),L.push(()=>j(e,"webCamElem",z));function D(n){t[10](n)}let C={src:"img/robot/ezgif-frame-[000].webp",total:X,offset:38,frame:t[5]};t[4]!==void 0&&(C.sequenceElem=t[4]),f=new se({props:C}),L.push(()=>j(f,"sequenceElem",D));let i=!t[1]&&G(t);return{c(){O(e.$$.fragment),a=w("canvas"),l=w("div"),r=w("div"),O(f.$$.fragment),i&&i.c(),u=N(),this.h()},l(n){R(e.$$.fragment,n),a=v(n,"CANVAS",{width:!0,height:!0,class:!0}),F(a).forEach(h),l=v(n,"DIV",{class:!0});var c=F(l);r=v(c,"DIV",{class:!0});var g=F(r);R(f.$$.fragment,g),g.forEach(h),c.forEach(h),i&&i.l(n),u=N(),this.h()},h(){d(a,"width",s=t[6].w),d(a,"height",m=t[6].h),d(a,"class","svelte-1q3b5km"),d(r,"class","sequence svelte-1q3b5km"),d(l,"class","video-container svelte-1q3b5km")},m(n,c){S(e,n,c),V(n,a,c),t[9](a),V(n,l,c),K(l,r),S(f,r,null),i&&i.m(n,c),V(n,u,c),p=!0,b||(E=Q(window,"resize",t[7]),b=!0)},p(n,[c]){const g={};c&2&&(g.active=n[1]),!o&&c&1&&(o=!0,g.webCamElem=n[0],W(()=>o=!1)),e.$set(g),(!p||c&64&&s!==(s=n[6].w))&&d(a,"width",s),(!p||c&64&&m!==(m=n[6].h))&&d(a,"height",m);const I={};c&32&&(I.frame=n[5]),!_&&c&16&&(_=!0,I.sequenceElem=n[4],W(()=>_=!1)),f.$set(I),n[1]?i&&(i.d(1),i=null):i?i.p(n,c):(i=G(n),i.c(),i.m(u.parentNode,u))},i(n){p||(M(e.$$.fragment,n),M(f.$$.fragment,n),p=!0)},o(n){A(e.$$.fragment,n),A(f.$$.fragment,n),p=!1},d(n){n&&(h(a),h(l),h(u)),y(e,n),t[9](null),y(f),i&&i.d(n),b=!1,E()}}}const X=26;function me(t,e,o){return Math.max(e,Math.min(t,o))}function fe(t,e,o){let a;Y(t,ie,i=>o(6,a=i));let s=null,m=null,l=null,r=!1,f=null,_=0,u=0;function p(i,n){n&&i&&(_=1-me((.75-i.x)*3,0,1),o(5,u=Math.round(_*X)),console.log(i.x,_,u))}function b(){o(2,s.width=a.w,s),o(2,s.height=a.h,s)}Z(()=>{s.getContext("2d"),b()}),x(()=>{le()});function E(i){m=i,o(0,m)}function z(i){L[i?"unshift":"push"](()=>{s=i,o(2,s)})}function q(i){f=i,o(4,f)}function D(i){L[i?"unshift":"push"](()=>{l=i,o(3,l)})}const C=()=>o(1,r=!0);return t.$$.update=()=>{t.$$.dirty&3&&r&&oe(m,p)},[m,r,s,l,f,u,a,b,E,z,q,D,C]}class ue extends H{constructor(e){super(),J(this,e,fe,ce,T,{})}}function de(t){let e,o;return e=new ue({}),{c(){O(e.$$.fragment)},l(a){R(e.$$.fragment,a)},m(a,s){S(e,a,s),o=!0},p:U,i(a){o||(M(e.$$.fragment,a),o=!0)},o(a){A(e.$$.fragment,a),o=!1},d(a){y(e,a)}}}class ge extends H{constructor(e){super(),J(this,e,null,de,T,{})}}export{ge as component};
